# 勉強会資料（2025/12/4）

## 目的
コンペにしっかり取り組むのが初めてなので、みなさんはどのように進めているか知りたい.  
不動産価格取り組んだことがある方は、Tips教えてほしい.  
GISデータの可視化の方法をまだ手探りなので、良い方法があれば教えてほしい.  

---

## コンペ概要
- 不動産価格を予測するモデル
    - [第2回 国土交通省 地理空間情報データチャレンジ](https://user.competition.signate.jp/ja/competition/detail/?competition=2b0105bc0c674f258e39cb2c7711e36f)
- 使用データ
    - trainデータ
        - 2019年〜2022年の1月または7月にLIFULLポータル上に掲載された物件データ
    - testデータ
        - 2023年の1月または7月にLIFULLポータル上に掲載された物件データ
    - 利用可能な外部データ
        - 国土数値情報(<span style="color: red; ">**必須**</span>)
            - [国土数値情報ダウンロードサイト](https://nlftp.mlit.go.jp/ksj/)
        - 登記所備付情報地図データ
            - [登記所備付地図データダウンロードサイト](https://front.geospatial.jp/moj-chizu-xml-readme/)
- 評価指標
    - MAPE
        - 低価格をより当てる方針
        - 去年の第1回は賃貸価格の予測でMAEだった（高価格をより当てないといけない）
- 今の最高パブリックスコア
    - 16.99834777577206（107位）


## 進め方
- 大枠
    - **ChatGPT先生に教えを乞いながら、作成する特徴量や次のアクションを決定**
- 進め方
    1. 必要最低限の特徴量とモデルでベースラインを作る
        - data_definition.xlsxで使う特徴量にフラグを立てていく
        - モデルはLightGBMでパラメータはチューニングしない（学習時間が短くなるようにn_estimators=500に設定）
    1. 学習済みモデルに学習データを再予測（リーク許容）させたMAPEと、特徴量重要度(FI)、(提出していれば)パブリックスコアをCHatGPTにぶち込んで、方針を決定
    1. 提案された特徴量エンジニアリング(FE)は少しずつ試しながら精度を確認
        - 反省
            - パブリックスコアの確認を毎回できないので、過学習が進んでしまう
        - 今の対策：
            - あとでモデルをチューニングするので一旦許容
            - FIが低い（スコア2以下）特徴量を除外して再学習
    1. 学習データも少しずつ追加していき、上記2〜3を回す
        - まだ全ての特徴量を利用できていないが、今バージョン3まである
    1. 一度ターゲットを変更したり、簡単なモデル分割を実施
        - 最初は不動産価格のLog変換 → 市区町村ごとの平均不動産価格に対しての相対比率
            - 市区町村の相場をベースに、その物件は相対的にどうか？という目的変数の持ち方
            - 結果的にあんまり精度が上がらなかったので、不採用😢
        - 今はベースモデルと小規模特化モデルを作成
            - 今回の評価指標はMAPEなので低価格をより当てていきたい
            - ベースモデルの予測結果が閾値（1000万円）以下であれば小規模と3：7で重みづけ
            - アホみたいに過学習が進んだもののパブリックスコアも上がったので採用🎉
    

## ここまでの収穫
- 特徴量150個見るのはしんどいなあと最初は思っていたが、小さく始めるが自分のモチベーション的にもあっていた
    - 去年の第1回の成績上位者が言っていたので真似してみたら自分にもあっていたので継続したい🔥
- 特徴量を増やすとその都度スコアは上がる
    - 不動産価格は色んな因子が影響している
    ```math
    不動産価格 = 土地の価値 + 建物の価値 + 周辺環境の価値.   
    ```
    - さらにいうと
        - 土地の価値 ← 資産的な価値（周辺環境の影響も受ける）
            - 今は駅名や市区町村名で代理（これから地価を入れるのでここはほぼ正解データになるはず）
        - 建物の価値 ← 資産もありつつ、快適さ・便利さといった主観的な価値も入る）
            - 建物自体の価値（RC構造、高層マンション、エレベーター、コンシェルジュなど）
            - 部屋の価値（LDK、バス・トイレ別、ペット可、床暖房など）
            - 基本的に築年数に比例して価値は減退するが、リノベやリフォームでその減退率を抑えることができる
                - 恐らくこの減退率も地域差などがあるはず
        - 周辺環境の価値
            - 結局は人口が集まっているかではないかと考えている
            - 居住人口が少なくとも、商業施設に近かったりターミナル駅があるなども影響しそう（まだうまく整理できていない。。。）

## これからの動き
- GEOデータ(GISデータ)の追加
    - 候補
        - 土地の価値
            - 公示地価
            - ハザードマップ
        - 建物の価値（ここに該当するGISデータはあんまり思いついていない）
        - 周辺環境の価値
            - 1kmメッシュあたりの人口（人口密度）
            - 区画ごとの将来人口
            - 都市計画
            - 駅の乗降者数
    - EDA
        - QJIS(無料のGEOデータ可視化ツール)
            - GUIで操作可能
            - 複数のデータをレイヤーとして重ねて表示できる
            - 無償版だからなのか、めちゃ重い…（他に良いツールがあれば教えてください）
        - Python(GeoPandas＋matplotlib、Choropleth、Contextily、Folium、Plotly）
            - matplotlibは静的だからめんどくさいし、Foliumはインタラクティブだけど重たいから嫌になりました（いい方法あれば教えていただきたいです）
- モデルの工夫
    - モデルの分割
        - 主要都市は分ける（東京モデル、大阪モデル、地方都市モデルなど）
        - 建物の種類で分ける（マンションモデル、アパートモデル、一軒家モデル）
    - 去年の成績上位者の中にはデータの分割をやっている参加者もいた
    - 後補正
        - これは最終手段
